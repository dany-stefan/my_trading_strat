# RSI Rainy Day Strategy - User Guide

## ðŸ“§ Email Preview & Testing

### Option 1: Local HTML Preview (No Email Sent)
**Command:**
```bash
python simulate_payday_email.py
```

**What it does:**
- Fetches current SPY price and RSI
- Generates email content
- Creates `simulated_email_preview.html` file
- **Does NOT send any email**

**Output:**
- View the HTML file in your browser to see exactly how the email will look
- Perfect for testing formatting changes safely

---

### Option 2: Send Real Test Email (Local)
**Command:**
```bash
bash local_email_send_test.sh
```

**What it does:**
- Sends a **real email** to your Gmail inbox
- Marks email as "ðŸ§ª TEST EMAIL (Local Run)"
- Does NOT update tracking.json (no cash pool changes)

**Email received:**
- Subject: `ðŸ§ª TEST EMAIL (Local Run): Investment Metrics - [Date]`
- Header: "ðŸŽ¯ RSI STRATEGY MONITOR - TEST EMAIL (LOCAL RUN)"
- Notice: "ðŸ§ª THIS IS A TEST EMAIL FROM LOCAL RUN"

---

### Option 3: Manual GitHub Actions Trigger (Test Email)
**Where:** GitHub repository â†’ Actions tab â†’ "RSI Strategy Monitor" workflow

**Steps:**
1. Go to: https://github.com/dany-stefan/my_trading_strat/actions
2. Click "RSI Strategy Monitor"
3. Click "Run workflow" button (top right)
4. Click green "Run workflow" button

**What it does:**
- Sends a **real email** to your Gmail inbox
- Marks email as "ðŸ§ª TEST EMAIL (Local Run)"
- Does NOT update tracking.json

**Email received:**
- Same as Option 2 (marked as TEST EMAIL)

---

### Option 4: Scheduled GitHub Actions (Official Execution Day Email)
**Schedule:** Automatically runs on 3rd and 17th of each month at 1:00 PM EST (or next TSX trading day)

**Important:** Payday is the 1st and 15th, but email alerts and buy order execution occur on the 3rd and 17th (2 days later) to align with Wealthsimple's recurring purchase schedule.

**What it does:**
- Sends **official execution day email** to your Gmail inbox
- Updates tracking.json with cash pool and rainy buys
- Records rainy day purchases

**Email received:**
- Subject: `ðŸ“… EXECUTION DAY: Investment Metrics - [Date]`
- Header: "ðŸŽ¯ RSI STRATEGY MONITOR - EXECUTION DAY"
- **No test markers** - this is the real thing!
- Note: Execution occurs on 3rd/17th (2 days after payday on 1st/15th)

## ðŸ“Š Strategy Analysis & Reports

The main backtest analysis and reports are located in the parent directory structure. This `rsi_double_dca_backtest_PROD/` folder contains the **production email monitoring system** only.

For comprehensive strategy analysis, see:
- `Strategy_Comparisons_with_Variants_Analysis.md` - Full performance analysis
- `Summary_Analysis.md` - Executive summary
- `IMPLEMENTATION_GUIDE.md` - Setup and configuration guide

---

## ðŸ“§ Email Content Structure

### What's Included in Every Email

1. **Current Market Data**
   - SPY price (USD)
   - RSI SMA(7) value (7-day Simple Moving Average of RSI(14) - this is your rainy day threshold)
   - Rainy day status (RSI SMA(7) < 45?)

2. **Today's Actions**
   - Base investment: $150 CAD (always)
   - Rainy day check results
   - Recommendation (buy extra $150 or save cash)
   - Cash pool before/after

3. **Performance Tables**
   - Variant Performance Summary (3 variants)
   - Strategy vs Alternatives (DCA, Buy & Hold)
   - Top 3 Variants Comparison

4. **Strategy Framework**
   - Execution schedule (3rd & 17th, which is 2 days after payday on 1st & 15th)
   - Cash accumulation rules ($30 per execution day)
   - Rainy day deployment rules (RSI SMA(7) < 45)
   - Why RSI SMA(7) was chosen over raw RSI(14)
   - Wealthsimple recurring buy alignment

5. **Current Status**
   - Cash pool balance
   - Total contributions to date
   - Total rainy buys to date
   - Expected long-term results

6. **Attached Charts** (5 PNG files)
   - Charts from backtest analysis (if available)
   - Note: Charts are generated by separate backtest scripts

---

## ðŸ”§ Data Flow Diagram

```
monitor_strategy.py (scheduled: 3rd & 17th via GitHub Actions)
Note: Payday is 1st & 15th, execution is 2 days later (3rd & 17th)
    â†“
Fetches live market data from Yahoo Finance
    - SPY price
    - RSI(14) calculated from closing prices
    - RSI SMA(7) calculated from RSI values
    â†“
Checks rainy day condition: RSI SMA(7) < 45?
    â†“
Generates email with:
    - Current market metrics (RSI SMA(7), price)
    - Buy recommendation (base $150 + rainy $150 if triggered)
    - Cash pool status
    - Historical performance tables
    - Strategy framework explanation
    â†“
Sends email to Gmail
    â†“
Updates strategy_tracking.json
    - Cash pool balance
    - Rainy buy history (date, rsi_sma, price, amount)
    - Total contributions
```

**Test Flow (local_email_send_test.sh):**
```
Same as above, but:
- Marks email as "ðŸ§ª TEST EMAIL (Local Run)"
- Does NOT update strategy_tracking.json
- Can be run anytime (not limited to paydays)
```

---

## ðŸ“‚ File Structure

```
rsi_double_dca_backtest_PROD/
â”œâ”€â”€ Python Scripts
â”‚   â”œâ”€â”€ monitor_strategy.py               # Production email sender (GitHub Actions)
â”‚   â”œâ”€â”€ simulate_payday_email.py          # Local HTML preview generator
â”‚   â”œâ”€â”€ email_formatter.py                # Shared HTML formatting
â”‚   â”œâ”€â”€ email_generator.py                # Shared email content generation
â”‚   â”œâ”€â”€ compare_rsi_sma_paydays.py        # RSI vs SMA analysis tool
â”‚   â”œâ”€â”€ test_multiple_dates.py            # Test RSI values for specific dates
â”‚   â””â”€â”€ test_rsi_ema_nov15.py             # Historical RSI test script
â”‚
â”œâ”€â”€ Shell Scripts
â”‚   â””â”€â”€ local_email_send_test.sh          # Send test email locally
â”‚
â”œâ”€â”€ Data Files
â”‚   â”œâ”€â”€ strategy_tracking.json            # Live tracking (cash pool, rainy buys)
â”‚   â””â”€â”€ rsi_vs_sma_payday_analysis.csv    # RSI vs SMA comparison data
â”‚
â”œâ”€â”€ Generated Reports
â”‚   â”œâ”€â”€ Strategy_Comparisons_with_Variants_Analysis.md  # Comprehensive analysis
â”‚   â”œâ”€â”€ Summary_Analysis.md                             # Executive summary
â”‚   â”œâ”€â”€ IMPLEMENTATION_GUIDE.md                         # Setup instructions
â”‚   â””â”€â”€ simulated_email_preview.html                    # Local preview
â”‚
â””â”€â”€ Generated Charts (PNG)
    â””â”€â”€ (Charts attached to emails - generated by separate backtest script)
```

---

## ðŸŽ¯ Quick Reference

| What I Want | Command | Sends Email? | Updates Tracking? |
|-------------|---------|--------------|-------------------|
| Preview HTML only | `python simulate_payday_email.py` | âŒ No | âŒ No |
| Test email (local) | `bash local_email_send_test.sh` | âœ… Yes (marked TEST) | âŒ No |
| Test email (GitHub) | Manual workflow trigger | âœ… Yes (marked TEST) | âŒ No |
| Official payday email | GitHub Actions (scheduled) | âœ… Yes (official) | âœ… Yes |
| Compare RSI vs SMA | `python compare_rsi_sma_paydays.py` | âŒ No | âŒ No |
| Test specific dates | `python test_multiple_dates.py` | âŒ No | âŒ No |

---

## ðŸ’¡ Tips

- **Before making changes:** Run `python simulate_payday_email.py` to preview
- **Testing email format:** Use `bash local_email_send_test.sh` to send test email
- **Check current status:** View `strategy_tracking.json` for cash pool and rainy buy history
- **Compare indicators:** Run `python compare_rsi_sma_paydays.py` to analyze RSI vs RSI SMA agreement
- **Test specific dates:** Use `python test_multiple_dates.py` to get RSI values for chart comparison
- **Review strategy analysis:** See `Strategy_Comparisons_with_Variants_Analysis.md` for comprehensive analysis

---

## ðŸ” Email Configuration

- **Sender:** d4388707373@gmail.com
- **Recipient:** d4388707373@gmail.com
- **SMTP:** smtp.gmail.com:587
- **App Password:** Stored in GitHub Secrets (for Actions)
- **Local Password:** Hardcoded in `monitor_strategy.py` (kzuf dozw badx wwro)

---

## âš™ï¸ Strategy Parameters

- **Base DCA:** $150 CAD every payday
- **Rainy Amount:** $150 CAD extra (when RSI SMA(7) < 45)
- **Cash Accumulation:** $30 CAD per payday
- **RSI SMA(7) Threshold:** < 45.0 (7-day Simple Moving Average of RSI(14))
- **Why RSI SMA(7)?** Reduces noise and false signals compared to raw RSI(14)
  - 85.6% agreement with raw RSI on payday schedule
  - Hit rate difference: only +0.4% (minimal impact)
  - Prevents buying on temporary RSI dips that quickly reverse
  - Smooths out daily volatility for more reliable signals
- **Schedule:** 1st and 15th of each month
- **Asset:** SPY (S&P 500 ETF)

---

## ðŸš€ Next Steps

1. **Test the system:** Run `bash local_email_send_test.sh` to verify email looks good on your iPhone
2. **Preview HTML formatting:** Run `python simulate_payday_email.py` and open the HTML file
3. **Understand the indicator:** Run `python compare_rsi_sma_paydays.py` to see RSI vs SMA analysis
4. **Wait for payday:** GitHub Actions will automatically send official emails on 1st & 15th
5. **Monitor performance:** Check `strategy_tracking.json` to see cash pool and rainy buy history
6. **Review strategy:** Read `Strategy_Comparisons_with_Variants_Analysis.md` for full analysis
