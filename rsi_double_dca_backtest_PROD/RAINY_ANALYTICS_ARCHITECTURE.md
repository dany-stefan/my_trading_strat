# Rainy Day Analytics - Modular JSON Architecture

## ğŸ“Œ Overview

Rainy day buy analytics are now **modular and JSON-based** for easy consumption across scripts and systems.

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  rainy_buys_calendar_dates.csv     â”‚  â† Generated by backtest
â”‚  (Source of Truth - Raw Data)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Process via rainy_analytics.py
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  rainy_analytics.json               â”‚  â† Calculated metrics
â”‚  (Processed Analytics)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Consumed by multiple scripts
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ“ email_generator.py     (HTML emails)             â”‚
â”‚  âœ“ simulated_email_preview.html  (Email preview)    â”‚
â”‚  âœ“ Custom dashboards      (Future)                  â”‚
â”‚  âœ“ Any script needing rainy analytics               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š JSON Structure

**File:** `rainy_analytics.json`

```json
{
  "generated_at": "2025-11-25 14:30:00",
  "current_spy_price": 674.98,
  "data_source": "rainy_buys_calendar_dates.csv",
  
  "summary": {
    "total_contributions": 12450.00,
    "num_buys": 83,
    "avg_buy_price": 210.14,
    "total_shares": 105.05,
    "current_value": 54729.28,
    "profit": 42279.28,
    "roi_percent": 339.59,
    "price_appreciation_multiple": 3.21,
    "first_buy_date": "2004-03-17",
    "last_buy_date": "2025-04-24",
    "years_active": 22
  },
  
  "all_periods": [ /* All years sorted by ROI */ ],
  "top_periods": [ /* Top 5 performing years */ ],
  "recent_periods": [ /* Last 5 years */ ],
  "individual_buys": [ /* All 83 individual buys */ ]
}
```

## ğŸ”§ Usage

### Generate Analytics (from backtest)

```python
from rainy_analytics import generate_rainy_analytics

# Generate fresh analytics from CSV
analytics = generate_rainy_analytics()
# Creates: rainy_analytics.json
```

**Automatically called by:**
- `rsi_calendar_date_backtest.py` - After saving CSV

### Load Analytics (for consumption)

```python
from rainy_analytics import load_rainy_analytics

# Load analytics from JSON
analytics = load_rainy_analytics()

# Access summary metrics
print(f"Total ROI: {analytics['summary']['roi_percent']}%")
print(f"Total Contributions: ${analytics['summary']['total_contributions']}")

# Access top performing periods
for period in analytics['top_periods']:
    print(f"{period['year']}: {period['roi_percent']}% ROI")
```

**Used by:**
- `email_generator.py` - Bi-weekly HTML emails
- `simulated_email_preview.html` - Email preview generation
- Any script needing rainy day metrics

## âœ… Benefits

### 1. **Single Source of Truth**
- CSV = raw data (from backtest)
- JSON = calculated analytics (from CSV)
- No duplicate calculations across scripts

### 2. **Modularity**
- Email generator doesn't need CSV logic
- HTML templates just read JSON
- Easy to add new consumers (dashboards, reports, APIs)

### 3. **Performance**
- Pre-calculated metrics
- No need to re-parse CSV every time
- Faster email generation

### 4. **Maintainability**
- Change analytics logic in ONE place (`rainy_analytics.py`)
- All consumers automatically updated
- Easier to add new metrics

### 5. **Accessibility**
- JSON is language-agnostic
- Can be consumed by Python, JavaScript, Node.js, etc.
- Easy to expose via API or web dashboard

## ğŸ”„ Workflow

### During Backtest

```bash
python rsi_calendar_date_backtest.py
```

1. Generates `rainy_buys_calendar_dates.csv`
2. Automatically calls `generate_rainy_analytics()`
3. Creates `rainy_analytics.json`

### During Email Generation

```python
# email_generator.py
from rainy_analytics import load_rainy_analytics

# Loads pre-calculated analytics
analytics = load_rainy_analytics()

# Use in email
rainy_roi = analytics['summary']['roi_percent']
top_years = analytics['top_periods'][:5]
```

### Manual Refresh

```bash
# If CSV was updated manually
python rainy_analytics.py
```

## ğŸ“‹ Available Metrics

### Summary Metrics
- `total_contributions` - Total $ invested in rainy buys
- `num_buys` - Number of rainy day purchases
- `avg_buy_price` - Average SPY price on rainy days
- `total_shares` - Total shares from rainy buys
- `current_value` - Current value of rainy shares
- `profit` - Dollar profit on rainy contributions
- `roi_percent` - Percentage return on rainy $ only
- `price_appreciation_multiple` - Price growth (e.g., 3.21x)
- `first_buy_date` - First rainy buy date
- `last_buy_date` - Most recent rainy buy
- `years_active` - Number of years with rainy buys

### Period Metrics (per year)
- `year` - Calendar year
- `num_buys` - Buys in that year
- `total_contributions` - $ invested that year
- `avg_price` - Avg SPY price that year
- `total_shares` - Shares bought that year
- `current_value` - Current value of shares from that year
- `profit` - Profit from that year's buys
- `roi_percent` - ROI for that year's contributions
- `start_date` - First rainy buy of year
- `end_date` - Last rainy buy of year
- `duration_days` - Days between first and last buy

### Individual Buy Metrics
- `date` - Buy date
- `rsi_sma` - RSI SMA(7) value that day
- `price` - SPY price
- `amount` - $ invested
- `shares` - Shares purchased
- `current_value` - Current value of those shares
- `profit` - Profit on that specific buy
- `roi_percent` - ROI on that specific buy

## ğŸ¯ Migration Guide

### Before (Direct CSV Reading)
```python
# âŒ Old way - duplicate logic in every script
import pandas as pd
df = pd.read_csv('rainy_buys_calendar_dates.csv')
total_invested = df['amount'].sum()
df['shares'] = df['amount'] / df['price']
# ... more calculations ...
```

### After (JSON Module)
```python
# âœ… New way - use shared module
from rainy_analytics import load_rainy_analytics
analytics = load_rainy_analytics()
total_invested = analytics['summary']['total_contributions']
# All metrics pre-calculated!
```

## ğŸ“¦ Files

- **`rainy_analytics.py`** - Analytics generator and loader module
- **`rainy_analytics.json`** - Generated analytics (included in ZIP)
- **`rainy_buys_calendar_dates.csv`** - Source data (from backtest)

## ğŸ” Validation

To verify analytics are correct:

```bash
# Generate fresh analytics
python rainy_analytics.py

# Check summary
cat rainy_analytics.json | jq '.summary'
```

Expected output:
```json
{
  "total_contributions": 12450.00,
  "roi_percent": 339.59,
  "num_buys": 83,
  ...
}
```

## ğŸš€ Future Enhancements

The modular JSON architecture enables:
- [ ] Web dashboard consuming JSON
- [ ] REST API endpoint for analytics
- [ ] Real-time analytics updates
- [ ] Mobile app integration
- [ ] Comparison across multiple strategies
- [ ] Historical analytics snapshots

## âš ï¸ Important Notes

1. **CSV is source of truth** - Always generated by backtest
2. **JSON is derived** - Generated from CSV via `rainy_analytics.py`
3. **Auto-generated** - Backtest calls `generate_rainy_analytics()` automatically
4. **Always in sync** - JSON regenerated every backtest run
5. **Included in ZIP** - JSON file included in email reports ZIP

## ğŸ“š Related Files

- `rainy_analytics.py` - **SINGLE SOURCE OF TRUTH** for analytics calculations
- `email_generator.py` - Consumes JSON for bi-weekly emails
- `rsi_calendar_date_backtest.py` - Generates CSV and JSON
- `to_share_via_email_reports.txt` - Includes JSON in ZIP
