# Update Workflow: Keeping Email Reports Current

## ğŸ¯ Purpose
This document explains what needs to be regenerated whenever you make changes to ensure all files in the ZIP email package are up-to-date.

---

## ğŸ“¦ What Gets Zipped and Emailed

**23 files total** (as listed in `to_share_via_email_reports.txt`):

### Markdown Reports (8 files)
1. `PROD.md` - Main PROD strategy report
2. `TURBO.md` - TURBO strategy report  
3. `STRATEGY_PERFORMANCE_SUMMARY.md` - Cross-strategy comparison
4. `RSI_VERIFICATION_LIST.txt` - Strategy verification checklist
5. `INCREASE_RAINY_CONTRIBUTION_ANALYSIS.md` - Rainy contribution analysis
6. `rsi_double_dca_backtest_PROD/Summary_Analysis.md` - Executive summary
7. `rsi_double_dca_backtest_PROD/README_HIT_MISS_CHARTS.md` - Chart documentation
8. `rsi_double_dca_backtest_PROD/COMPREHENSIVE_PERFORMANCE_REPORT.md` - Detailed metrics

### Charts/PNGs (15 files)
All located in `rsi_double_dca_backtest_PROD/`:
- `strategy_comparison_with_baseline.png`
- `rainy_day_analysis_detailed.png`
- `spy_price_rainy_periods_drawdown.png`
- `rsi_timeline_rainy_days.png`
- `rainy_periods_timeline.png`
- `rainy_periods_returns.png`
- `rainy_periods_investment_vs_value.png`
- `rainy_deployments_on_spy_chart.png`
- `rainy_periods_top_vs_recent.png`
- `rainy_cumulative_value_over_time.png`
- `strategy_comparison_calendar_dates.png`
- `cash_pool_analysis.png`
- `cash_pool_hit_miss.png`
- `spy_price_hit_miss.png`
- `rsi_hit_miss.png`

---

## ğŸ”„ The Update Workflow

### **RULE: After ANY change to strategy code or markdown reports, run:**

```bash
cd rsi_double_dca_backtest_PROD
/Users/danystefan/Documents/workspace/my_trading_strat/.venv/bin/python run_all_batch.py
```

This regenerates:
âœ… All CSV files (equity curves, rainy buys)
âœ… All 15 PNG charts
âœ… `COMPREHENSIVE_PERFORMANCE_REPORT.md`
âœ… `RSI_VERIFICATION_LIST.txt` (automatically fills missing dates through today)

### **Automatic RSI Verification Updates**

The system now automatically updates `RSI_VERIFICATION_LIST.txt`:

1. **When `run_all_batch.py` runs** - Adds all missing dates from last entry to today
2. **When `monitor_strategy.py` runs** (GitHub Actions) - Updates verification list before sending email
3. **Manual update**: Run `python update_rsi_verification.py` anytime

Each entry includes:
- Date
- RSI(14) value
- RSI SMA(7) value  
- Rainy day indicator (ğŸŒ§ï¸ if < 45, â›… if >= 45)
- Payday marker (if date is 3rd or 17th)

---

## ğŸ“§ What Uses These Files

### 1. **Email ZIP Package** (`to_share_send_reports_via_email.sh`)
- Packages all 23 files into `Trading_Strategy_Reports_YYYYMMDD.zip`
- Preserves folder structure so PNG references in markdown work
- Sends via macOS Mail.app to `stefan_dany@icloud.com`

### 2. **GitHub Actions Email** (`.github/workflows/rsi_monitor.yml`)
- Runs `monitor_strategy.py` on 3rd & 17th at 1 PM EST
- Email body generated by `email_generator.py`
- Uses `strategy_comparison.py` for current metrics
- Shows: $511,954 final, $71,850 invested, $77,903 gain

---

## âœ… Current Data (as of Nov 24, 2025)

**Backtest Results:**
- Final equity: **$511,953.79**
- Total invested: **$71,850**
  - Base DCA: $59,400 (396 paydays Ã— $150)
  - Rainy buys: $12,450 (83 buys Ã— $150)
- Rainy buys: **83** (hit rate: 97.6%)
- Outperformance vs DCA: **$77,903** (+17.9%)
- CAGR: **30.91%** (backtest), **9.34%** (ROI on contributions)

**Market Beating:**
- Rainy day CAGR: **8.11%**
- Market average: **8.00%**
- Beats market by: **+0.11%** annually
- Extra wealth: **+$1,549** over 22 years

---

## ğŸ”§ Quick Verification Commands

### Check if charts are current:
```bash
cd rsi_double_dca_backtest_PROD
ls -lth *.png | head -15
```
âœ… All should show today's date

### Verify markdown has correct numbers:
```bash
grep -r "511,954\|71,850\|83.*rainy" PROD.md Summary_Analysis.md COMPREHENSIVE_PERFORMANCE_REPORT.md
```
âœ… Should find multiple matches

### Test email generation:
```bash
cd rsi_double_dca_backtest_PROD
/path/to/.venv/bin/python simulate_payday_email.py 2025-11-24 | grep "Final Value\|Total Invested"
```
âœ… Should show $511,954 and $71,850

### Simulate ZIP creation:
```bash
cd /Users/danystefan/Documents/workspace/my_trading_strat
./to_share_send_reports_via_email.sh
```
âœ… Check Mail.app for draft with ZIP attachment

---

## ğŸ“Œ Important Notes

1. **Always regenerate after changes** - Don't manually edit CSVs or PNGs
2. **Charts reference CSV data** - If CSV changes, charts must be regenerated
3. **Markdown can reference outdated data** - Update markdown manually if numbers change
4. **Email template is dynamic** - It pulls from `strategy_comparison.py` at runtime
5. **GitHub Actions runs automatically** - Ensure `run_all_batch.py` ran recently before scheduled email

---

## ğŸš€ Complete Update Checklist

When you make changes, follow this checklist:

- [ ] 1. Edit code/strategy parameters in `rsi_double_dca_backtest_PROD/`
- [ ] 2. Run `run_all_batch.py` to regenerate all CSVs and PNGs
- [ ] 3. Update markdown files if they reference specific numbers
- [ ] 4. Test email generation with `simulate_payday_email.py`
- [ ] 5. Verify ZIP contains current files with `to_share_send_reports_via_email.sh`
- [ ] 6. Commit changes to git (triggers GitHub Actions on schedule)

---

## ğŸ“ File Dependencies

```
run_all_batch.py
â”œâ”€â”€ rsi_calendar_date_backtest.py â†’ equity CSVs, rainy_buys CSV
â”œâ”€â”€ rsi_variants_backtest.py â†’ variant PNGs, equity CSVs
â”œâ”€â”€ generate_rsi_timeline_chart.py â†’ rsi_timeline_rainy_days.png
â”œâ”€â”€ generate_hit_miss_charts.py â†’ hit/miss PNGs (3 charts)
â””â”€â”€ generate_performance_report.py â†’ COMPREHENSIVE_PERFORMANCE_REPORT.md

Email System:
â”œâ”€â”€ email_generator.py â†’ Uses strategy_comparison.py for metrics
â”œâ”€â”€ strategy_comparison.py â†’ Reads equity CSVs
â””â”€â”€ monitor_strategy.py â†’ Runs in GitHub Actions

ZIP Package:
â””â”€â”€ to_share_send_reports_via_email.sh â†’ Reads to_share_via_email_reports.txt
```

---

**Last Updated:** November 24, 2025  
**Last Regeneration:** November 24, 2025 14:48 (11 of 15 PNGs updated)  
**Email System Status:** âœ… Ready (all files current)
